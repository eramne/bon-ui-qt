var root=Function("return this")(),TokenType={STRING:'"',VAR:"x",CALL:"f",GROUP:"()",NUMBER:"#",OP:"*",LEFT_PAREN:"(",RIGHT_PAREN:")",COMMA:","},hasOwnProperty=Object.hasOwnProperty,DEFAULT_VAR_NAME_CHARS="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_$",BigEval=function(){this.order=[["!"],["**"],["\\","/","*","%"],["+","-"],["<<",">>"],["<","<=",">",">="],["==","=","!=","<>"],["&"],["^"],["|"],["&&"],["||"]],this.prefixOps=["!"],this.suffixOps=["!"],this.rightAssociativeOps={"**":!0},this.varNameChars=Object.create?Object.create(null):{};for(var e=DEFAULT_VAR_NAME_CHARS.split(""),t=0;t<e.length;t++)this.varNameChars[e[t]]=!0;this.flatOps=[];for(t=0;t<this.order.length;t++)this.flatOps=this.flatOps.concat(this.order[t]);this.CONSTANT={},this.FUNCTION={}};BigEval.prototype.DEFAULT_CONSTANTS={PI:Math.PI,PI_2:Math.PI/2,LOG2E:Math.LOG2E,DEG:Math.PI/180,E:Math.E},BigEval.prototype.FORCE_CONSTANTS={INFINITY:1/0,NAN:NaN,TRUE:!0,FALSE:!1},BigEval.prototype.exec=function(e){try{return this.execute(e)}catch(e){return"ERROR"}},BigEval.prototype.execute=function(e){var t;return t=e.__compiled_expression?e:this.compile(e),this._evaluateToken(t)},BigEval.prototype._opAtPosition=function(e,t){for(var r="",n=0,i=this.flatOps.length;n<i;n++){var o=this.flatOps[n];r===o||o.length<=r.length||e.substr(t,o.length)===o&&(r=o)}return r},BigEval.prototype._indexOfOpInTokens=function(e,t){for(var r=0;r<e.length;r++){var n=e[r];if(n.type===TokenType.OP&&n.value===t)return r}return-1},BigEval.prototype._lastIndexOfOpInTokens=function(e,t){for(var r=e.length-1;r>=0;r--){var n=e[r];if(n.type===TokenType.OP&&n.value===t)return r}return-1},BigEval.prototype._lastIndexOfOpArray=function(e,t){for(var r,n,i,o=-1,a=0;a<t.length;a++)i=t[a],-1!=(r=this.rightAssociativeOps.hasOwnProperty(i)?this._indexOfOpInTokens(e,i):this._lastIndexOfOpInTokens(e,i))&&(-1==o||r>o)&&(o=r,n=i);return[o,n]},BigEval.prototype._parseString=function(e,t,r,n){var i,o,a,s,l,u=t||0,p=e.length,h="",f=null;if(n&&"'"!==(f=e[u++])&&'"'!==f)throw new Error("Not a string");for(;u<p;u++)if("\\"===(i=e[u])){if(!(i=e[u+1]))throw new Error("Invalid string. An escape character with no escapee encountered at index "+u);if(u++,"\\"===i||"'"===i||'"'===i)h+=i;else if("b"===i)h+="\b";else if("f"===i)h+="\f";else if("n"===i)h+="\n";else if("r"===i)h+="\r";else if("t"===i)h+="\t";else if("u"===i||"x"===i){for(o=0,l="u"===i?4:2,a=0;a<l;a+=1){if((i=e[++u])>="0"&&i<="9")s=i-"0";else if(i>="a"&&i<="f")s=i-"a"+10;else{if(!(i>="A"&&i<="F")){if(r)throw new Error("Unexpected escape sequence at index "+(u-a-2));u--;break}s=i-"A"+10}o=16*o+s}h+=String.fromCharCode(o)}else{if(r)throw new Error("Unexpected escape sequence at index "+(u-1));h+=i}}else{if(i===f)return[h,u+1];h+=i}if(n)throw new Error("String must be quoted with matching single-quote (') or double-quote(\") characters.");return h},BigEval.prototype._parseNumber=function(e,t){var r,n=t||0,i=e.length,o=0,a=!1;if(n>=i)throw new Error("Can't parse token at "+n);for(;n<i;n++)if((r=e[n])>="0"&&r<="9"){if(1===o)break;o>1&&o++}else if("."===r){if(a||o>0)break;a=!0}else if("e"===r){if(o>0)break;o=1}else{if(1!==o||"-"!==r&&"+"!==r)break;o=2}if(n===t||1===o||2===o)throw new Error("Unexpected character at index "+n);return[e.substr(t,n-t),n]},BigEval.prototype._tokenizeExpression=function(e){for(var t,r=[],n=0,i=e.length;n<i;n++){var o=e[n];if(o>="0"&&o<="9"||"."===o)t=this._parseNumber(e,n),r.push({type:TokenType.NUMBER,pos:n,value:t[0]}),n=t[1]-1;else{var a=this.varNameChars[o];if(a){for(var s="";n<i&&(o=e[n],a=this.varNameChars[o]);)s+=o,n++;r.push({type:TokenType.VAR,pos:n-s.length,value:s}),n--}else if("'"!==o&&'"'!==o)if("("!==o)if(")"!==o)if(","!==o){if(" "!==o&&"\t"!==o&&"\f"!==o&&"\r"!==o&&"\n"!==o){var l=this._opAtPosition(e,n);if(!l)throw new Error("Unexpected token at index "+n);r.push({type:TokenType.OP,pos:n,value:l}),n+=l.length-1}}else r.push({type:TokenType.COMMA,pos:n});else r.push({type:TokenType.RIGHT_PAREN,pos:n});else r.push({type:TokenType.LEFT_PAREN,pos:n});else t=this._parseString(e,n,!1,!0),r.push({type:TokenType.STRING,pos:n,value:t[0]}),n=t[1]-1}}return r},BigEval.prototype._groupTokens=function(e,t){var r,n,i,o=t>0&&e[t-1].type===TokenType.VAR,a=e[o?t-1:t];o?(a.type=TokenType.CALL,n=a.args=[],i=[]):(a.type=TokenType.GROUP,i=a.tokens=[]);for(var s=t+1,l=e.length;s<l;s++)if(r=e[s],o&&r.type===TokenType.COMMA)i=[],n.push(i);else{if(r.type===TokenType.RIGHT_PAREN)return o?e.splice(t,s-t+1):e.splice(t+1,s-t),a;r.type!==TokenType.LEFT_PAREN?(o&&0===n.length&&n.push(i),i.push(r)):(this._groupTokens(e,s),s--,l=e.length)}throw new Error("Unmatched parenthesis for parenthesis at index "+e[t].pos)},BigEval.prototype._buildTree=function(e){for(var t,r,n,i,o,a,s=this.order,l=s.length-1;l>=0;l--)if(t=s[l],n=(r=this._lastIndexOfOpArray(e,t))[0],i=r[1],-1!==n){var u=e[n];if(-1!==this.prefixOps.indexOf(i)||-1!==this.suffixOps.indexOf(i)){if(o=null,a=null,-1!==this.prefixOps.indexOf(i)&&0===n?a=e.slice(n+1):-1!==this.suffixOps.indexOf(i)&&n>0&&(o=e.slice(0,n)),null===o&&null===a)throw new Error("Operator "+u.value+" is unexpected at index "+u.pos)}else o=e.slice(0,n),a=e.slice(n+1),0!==o.length||"-"!==i&&"+"!==i||(o=null);if(o&&0===o.length||a&&0===a.length)throw new Error("Invalid expression, missing operand");if(o||"-"!==i){if(!o&&"+"===i)return this._buildTree(a)}else o=[{type:TokenType.NUMBER,value:0}];return o&&(u.left=this._buildTree(o)),a&&(u.right=this._buildTree(a)),u}if(e.length>1)throw new Error("Invalid expression, missing operand or operator at "+e[1].pos);if(0===e.length)throw new Error("Invalid expression, missing operand or operator.");var p=e[0];if(p.type===TokenType.GROUP)p=this._buildTree(p.tokens);else if(p.type===TokenType.CALL)for(var h=0,f=p.args.length;h<f;h++)0===p.args[h].length?p.args[h]=null:p.args[h]=this._buildTree(p.args[h]);else if(p.type===TokenType.COMMA)throw new Error("Unexpected character at index "+p.pos);return p},BigEval.prototype.compile=function(e){var t,r,n,i,o=this._tokenizeExpression(e);for(n=1,i=o.length;n<i;n++)t=o[n],r=o[n-1],t.type!==TokenType.OP||"-"!==t.value&&"+"!==t.value||r.type!==TokenType.OP||"-"!==r.value&&"+"!==r.value?t.type!==TokenType.NUMBER||r.type!==TokenType.OP||"-"!==r.value&&"+"!==r.value||!(n>1&&o[n-2].type===TokenType.OP||1===n)||("-"===r.value&&(t.value=r.value+t.value),o.splice(n-1,1),n--,i=o.length):("+"!==r.value&&("-"===t.value?t.value="+":t.value="-"),o.splice(n-1,1),n--,i=o.length);for(n=0,i=o.length;n<i;n++)(t=o[n]).type===TokenType.LEFT_PAREN&&(this._groupTokens(o,n),i=o.length,n--);var a=this._buildTree(o);return a.__compiled_expression=!0,a},BigEval.prototype._evaluateToken=function(e){var t=e.value;switch(e.type){case TokenType.STRING:return t;case TokenType.NUMBER:return this.number(t);case TokenType.VAR:return void 0!==this.FORCE_CONSTANTS[t.toUpperCase()]?this.FORCE_CONSTANTS[t.toUpperCase()]:void 0!==this.CONSTANT[t]?this.CONSTANT[t]:void 0!==this.DEFAULT_CONSTANTS[t.toUpperCase()]?this.DEFAULT_CONSTANTS[t.toUpperCase()]:void 0;case TokenType.CALL:return this._evaluateFunction(e);case TokenType.OP:var r;switch(e.value){case"!":return e.left?this.fac(this._evaluateToken(e.left)):this.logicalNot(this._evaluateToken(e.right));case"/":case"\\":return this.div(this._evaluateToken(e.left),this._evaluateToken(e.right));case"*":return this.mul(this._evaluateToken(e.left),this._evaluateToken(e.right));case"+":return this.add(this._evaluateToken(e.left),this._evaluateToken(e.right));case"-":return this.sub(this._evaluateToken(e.left),this._evaluateToken(e.right));case"<<":return this.shiftLeft(this._evaluateToken(e.left),this._evaluateToken(e.right));case">>":return this.shiftRight(this._evaluateToken(e.left),this._evaluateToken(e.right));case"<":return this.lessThan(this._evaluateToken(e.left),this._evaluateToken(e.right));case"<=":return this.lessThanOrEqualsTo(this._evaluateToken(e.left),this._evaluateToken(e.right));case">":return this.greaterThan(this._evaluateToken(e.left),this._evaluateToken(e.right));case">=":return this.greaterThanOrEqualsTo(this._evaluateToken(e.left),this._evaluateToken(e.right));case"==":case"=":return this.equalsTo(this._evaluateToken(e.left),this._evaluateToken(e.right));case"!=":case"<>":return this.notEqualsTo(this._evaluateToken(e.left),this._evaluateToken(e.right));case"**":return this.pow(this._evaluateToken(e.left),this._evaluateToken(e.right));case"%":return this.mod(this._evaluateToken(e.left),this._evaluateToken(e.right));case"&":return this.and(this._evaluateToken(e.left),this._evaluateToken(e.right));case"^":return this.xor(this._evaluateToken(e.left),this._evaluateToken(e.right));case"|":return this.or(this._evaluateToken(e.left),this._evaluateToken(e.right));case"&&":return r=this._evaluateToken(e.left),this.isTruthy(r)?this._evaluateToken(e.right):r;case"||":return r=this._evaluateToken(e.left),this.isTruthy(r)?r:this._evaluateToken(e.right)}}throw new Error("An unexpected error occurred while evaluating expression")},BigEval.prototype._evaluateFunction=function(e){for(var t=e.value,r=[],n=0;n<e.args.length;n++)null===e.args[n]?r.push(void 0):r.push(this._evaluateToken(e.args[n]));if("function"==typeof this.FUNCTION[t])return this.FUNCTION[t].apply(this.FUNCTION[t],r);if("function"==typeof this[t])return this[t].apply(this,r);if("function"==typeof Math[t])return Math[t].apply(Math,r);if("function"==typeof root[t])return root[t].apply(root,r);throw new Error('Function named "'+t+'" was not found')},BigEval.prototype.number=function(e){return Number(e)},BigEval.prototype.add=function(e,t){return e+t},BigEval.prototype.sub=function(e,t){return e-t},BigEval.prototype.mul=function(e,t){return e*t},BigEval.prototype.div=function(e,t){return e/t},BigEval.prototype.pow=function(e,t){return Math.pow(e,t)},BigEval.prototype.lessThan=function(e,t){return e<t},BigEval.prototype.lessThanOrEqualsTo=function(e,t){return e<=t},BigEval.prototype.greaterThan=function(e,t){return e>t},BigEval.prototype.greaterThanOrEqualsTo=function(e,t){return e>=t},BigEval.prototype.equalsTo=function(e,t){return e==t},BigEval.prototype.notEqualsTo=function(e,t){return e!=t},BigEval.prototype.isTruthy=function(e){return!!e},BigEval.prototype.logicalNot=function(e){return!this.isTruthy(e)},BigEval.prototype.fac=function(e){for(var t=1,r=2;r<=e;r++)t=this.mul(t,r);return t},BigEval.prototype.mod=function(e,t){return e%t},BigEval.prototype.shiftLeft=function(e,t){return e<<t},BigEval.prototype.shiftRight=function(e,t){return e>>t},BigEval.prototype.and=function(e,t){return e&t},BigEval.prototype.xor=function(e,t){return e^t},BigEval.prototype.or=function(e,t){return e|t},"undefined"!=typeof module&&module.exports&&"undefined"!=typeof exports&&(module.exports=BigEval);